{% extends "base.html" %}
{% block content %}
<div class="container" style="margin-top: 30px">
  <div class="row">
    <div class="col-md-12">
      <ul class="list-group">
        <a class="list-group-item active">{{homework.name}}</a>
        {% for question in questions %}
        <div class="list-group-item" id = "question{{ loop.index }}">
        </div>
        {% endfor %}
        <div class="list-group-item">
          <!--<div id="body"></div>-->
          <br>
          <button class="btn btn-default" onclick="postform()">提交</button>
          <button class="btn btn-default" onclick="window.location.href='/courses/id/{{homework.class_id}}/homework'">返回</button>
        </ul>
      </div>
    </div>
  </div>
</div>
{% for question in questions %}
  <div id="raw_question{{ loop.index }}" style="display: none">{{questions[loop.index - 1].content}}</div>
{% endfor %}
<script>
function postform() {
  var f = true;
  for (var i = 0; i < {{ questions|length }}; i++) {
    val = $('#question' + (i + 1)).children('div').children('input:radio[name="radio-' + (i + 1) + '-1"]:checked').val()
    if (val == undefined) {
        if (f)
          alert("有试题未完成!")
        f = false;
    }
    else {
        $.post("./{{id}}",
        {
          question: i + 1,
          content: val,
        },
        function(data,status){
          console.log(data)
          if (data == 'Done') {
            //alert('提交成功')
            //window.location.href="./{{id}}";
          }
          else {
            f = false
            alert('提交失败，请检查网络连接。')
          }
        });
    }
  }
  if (f) {
      alert('提交成功')
      window.location.href="./{{id}}";
  }
}
var i = 0;
window.onload = function(){
  //渲染试题
  var len = {{ questions|length }};
  for (var p = 0; p < len; p++)
    $('#question' + (p + 1)).html(marked($("#raw_question" + (p + 1)).html()))
  var numInuptradio = 0
  for (var i = 0; i < {{ questions|length }}; i++) {
    var q = $('#question' + (i + 1)).children('div.inputradio')
    for (var j = 0; j < q.size(); j++) {
        console.log(q[j])
        console.log(q.eq(j).children('input').attr("name", "radio" + '-' + (i + 1) + '-' + (j + 1)));
    }
  }
  {% for i in questions %}
      {% if i.type == 1 %}
          $("input:radio[name='radio-{{loop.index}}-1']").eq({{answer_list[loop.index - 1]}}).attr("checked",true)
      {% endif %}
  {% endfor %}
}
</script>
{% endblock %}
